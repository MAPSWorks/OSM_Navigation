Žilinská Univerzita v Žiline Fakulta riadenia a informatiky

Bakalárska práca
Študijný program: informatika

Dušan Ščensný Softvér pre komunikáciu s GPS modulom a zobrazovanie GPS dát Vedúci: Mgr. Michal Kaukič, CSc. Reg.č. 77/2009 Máj 2010

PREHLÁSENIE

Prehlasujem, že som bakalársku prácu spracoval samostatne a že som uviedol všetky použité pramene a literatúru, z ktorých som čerpal.

V Žiline dňa . . . . . . . . . . . . . . . . . .

Podpis . . . . . . . . . . . . . . . . . .

Abstrakt Ščensný, Dušan: Softvér pre komunikáciu s GPS modulom a zobrazovanie GPS dát[bakalárska práca] - Žilinská Univerzita v Žiline. Fakulta riadenia a informatiky; Katedra matematických metód. -Vedúci: Mgr. Michal Kaukič, CSc. - Stupeň odbornej kvaliﬁkácie:Bakalár v odbore Informatika. Žilina: FRI ŽU v Žiline, 2010. - 43 s.

Cieľom tejto bakalárskej práce bolo vytvoriť robustnú aplikáciu, ktorá má komunikovať s GPS prístrojom a zobrazovať GPS dáta. Obvykle sú dáta vo forme trás a významných bodov, ktoré musia byť ukladané v pamäti konkrétnou údajovou štruktúrou. Základné funkcie GPS systému a práca s geograﬁckými dátami sú podrobne vysvetlené, pretože sú dôležité pre pochopenie systému navigácie a prepočtov potrebných pri vykresľovaní dát. Vo výslednej aplikácii bola použitá knižnica Qt pomocou ktorej bolo vytvorené jadro aplikácie aj graﬁcké rozhranie. Vývoj tejto aplikácie podnietilo hlavne to, že na trhu je nedostatok takýchto produktov ktoré sú jednoduché, rýchle a bezplatné. Aplikácia sa dá považovať za prvú fázu vo vývoji v ktorej sú implementované základné prvky softvéru pracujúceho s GPS prístrojom a samotnými mapami.

Kľúčové slová: GPS, Qt, Aplikácia, prístroj

Abstract Ščensný, Dušan: Software for communication with GPS module and GPS data visualization.[Bachelor thesis] - University of Žilina. Faculty of Management Science and Informatics;Department of mathematical methods - Tutor: Mgr. Michal Kaukič, CSc. - Qualiﬁcation level:Bachelor in ﬁeld Informatics. Žilina: FRI ŽU v Žiline, 2009. 43 p.

The object of this Bachelor thesis was to create a robus application, which comunicates with GPS device and displays the GPS data. Ususally are data in form of tracks and waypoints, which must be saved in memory in concrete data structure. The basic functions of GPS system and work with geographical data are in details explained, because of their important for comprehension of system navigation and calculation needed by drawing data. In ﬁnal application were used library called Qt by which were created core of application and a graphical interface. Development of this application in main motivate, that at market is lack of this products which are simple, fast and free. Application can be consider in ﬁrst phase at our development in which are implemented the basic component of software work with GPS device and maps.

Keywords: GPS, Qt, application, device

PREDHOVOR
Práca s mapami fascinovala už mnoho ľudí. Dôvod pre spracovanie tejto témy bol dlhodobý záujem o prácu s mapami a mapovým softvérom, tiež záujem o hlbšie poznanie GPS princípov a častí ktoré vo všeobecnosti nie sú známe. V úvode tejto práce nájdeme stručne popísaný prechod z histórie až po súčasnosť a zároveň stručný popis výberu softvéru, ktorý je dôležitý pri vývoji a tiež softvéru ktorý je vhodný použiť pri práci s dátami. V prvých troch kapitolách sú popísané základné prvky týkajúce sa geograﬁe, kartograﬁe a s ňou spojenej projekcie zemského povrchu do mapy. Následne sa v týchto kapitolách pojednáva o fungovaní GPS1 , ktorý je dôležitou súčasťou tejto práce. S navigačnými prístrojmi sa blízko spája protokol NMEA2 ktorý sa často používa ako základ pri prenose údajov z prístroja do počítača alebo priamo do softvéru. Programy ktoré sa používajú pri konvertovaní dát často používajú ako prenosový formát GPX3 . S formátom sa oboznámime v druhej kapitole. V práci nájdeme aj popis prístrojov na ktorých bola testovaná komunikácia softvéru. Posledná kapitola sa zaoberá vytvoreným softvérom OSM Navigation, popisom jeho hlavných častí, ako aj vysvetlenia konkrétnych prvkov použitých pri práci. V tejto kapitole sa nachádza postup na kompiláciu programu, vytváranie závislostí ako aj popis jednotlivých tried nachádzajúcich sa v programe. Softvér je použiteľný pre široké spektrum používateľov a to aj z toho dôvodu že nie je zameraný na konkrétny typ prístrojov. Rád by som poďakoval všetkým, ktorí mi pri tvorbe bakalárskej práce pomohli, či už cennými radami, pripomienkami, zapožičaním prístrojov alebo pomocou pri zhromažďovaní materiálov. Predovšetkým však poďakovanie patrí vedúcemu bakalárskej práce Mgr. Michalovi Kaukičovi, CSc.

1 2

GPS - globálny pozičný systém NMEA - národná vojenská asociácia pre elektroniku (national marine electronic association) 3 GPX - GPS eXchange format = formát na výmenu dát

Obsah
Úvod 1 Geograﬁcké údaje 1.1 1.2 Základné pojmy v geografii . . . . . . . . . . . . . . . . . . . . . Kartografická projekcia - Zobrazenie Máp . . . . . . . . . . . 1.2.1 1.3 Referenčný elipsoid . . . . . . . . . . . . . . . . . . . . . . . . . 4 6 6 7 8 9 10 11 11 12 12 13 15 15 16 17 18 19 20 20

GPS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1.3.1 Funkčnosť GPS systému . . . . . . . . . . . . . . . . . . .

1.4

Možnosti zobrazenia máp . . . . . . . . . . . . . . . . . . . . . . . 1.4.1 1.4.2 1.4.3 1.4.4 On-line mapy . . . . . . . . . . . . . . . . . . . . . . . . . . . . Spôsob sťahovania konkrétnych častí mapy . . . . . . . Google Mapy . . . . . . . . . . . . . . . . . . . . . . . . . . OpenStreetMap . . . . . . . . . . . . . . . . . . . . . . . . .

2 Spracovanie dát z GPS prístroja 2.1 2.2 Protokol NMEA 0183 . . . . . . . . . . . . . . . . . . . . . . . . . . . . Formát GPX . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2.2.1 2.3 2.4 Element gpx . . . . . . . . . . . . . . . . . . . . . . . . . . . .

Skytraq datalogger . . . . . . . . . . . . . . . . . . . . . . . . . . . . . GPS babel . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2.4.1 2.4.2 Príkazy v programe GPSbabel . . . . . . . . . . . . . . . . . . . Gebabbel . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

3 GPS prístroje použité v práci 3.1 GPS multi tracker . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3.1.1 3.1.2 3.1.3 3.2 Konﬁgurácia . . . . . . . . . . . . . . . . . . . . . . . . . . . . Sťahovanie dát a zaujímavých bodov . . . . . . . . . . . . . . . Navigácia . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

21 22 22 23 23 23 23 23 24

Navilock GPS Bluetooth Receiver BT-308 . . . . . . . . . . . . . . . . 3.2.1 3.2.2 Komunikácia . . . . . . . . . . . . . . . . . . . . . . . . . . . . Prijímanie aktuálnej pozície . . . . . . . . . . . . . . . . . . . .

4 Program OSM Navigation 4.1 Výber programovacieho jazyka a vývojového prostredia . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4.1.1 4.2 4.3 4.4 Qt Creator . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

24 25 26 27 28 28 29 31 32 33 33 35 35 36 36 37 39 42

Správa závislosti programu . . . . . . . . . . . . . . . . . . . . . . . . . Jazykové formáty programu . . . . . . . . . . . . . . . . . . . . . . . . Aplikačná a dátová vrstva programu . . . . . . . . . . . . . . . . . . . 4.4.1 4.4.2 4.4.3 4.4.4 Sťahovanie častí mapy . . . . . . . . . . . . . . . . . . . . . . . Načítanie dát zo súboru . . . . . . . . . . . . . . . . . . . . . . Prepočítavanie dát k zobrazeniu trasy . . . . . . . . . . . . . . Prepočítanie zemepisných súradníc . . . . . . . . . . . . . . . .

4.5

Užívateľská vrstva - GUI Aplikácia . . . . . . . . . . . . . . . . . . . . 4.5.1 4.5.2 4.5.3 Zobrazenie mapy . . . . . . . . . . . . . . . . . . . . . . . . . . Pripojenie GPS zariadenia . . . . . . . . . . . . . . . . . . . . . Hľadanie aktuálnej pozície . . . . . . . . . . . . . . . . . . . . .

4.6 Záver

Licencia aplikácie a požitých knižníc a programov . . . . . . . . . . . .

Literatúra Zoznam použitých skratiek Prílohy

ÚVOD
Prácou s mapami sa zaoberali ľudia už v staroveku, z dôvodu zachytenia prvkov nachádzajúcich sa v okolí. Jeden z dôvodov bol, že mapa nás priviedla vždy do cieľa, na miesto kde sme sa chceli dopraviť. Mapy sa využívali a využívajú všade okolo, môžeme to vidieť v histórii ale aj v aktuálnej dobe. V súčasnosti je snaha zachytiť každučký detail na mape, vecí a okolnosti ktoré nás zaujímajú, ktoré sú pre nás podstatné. K tomu aby sme mohli zaznamenať na mape rôzne detaily, nás rapídne posúva vpred elektronika z takzvaným GPS systémom. Za posledné dva desaťročia sa trh s touto elektronikou rapídne rozšíril, no nebolo tomu vždy tak. GPS je skratka pre Globálny pozičný systém, ktorý vyvinula Americká vláda počas studenej vojny. V časoch studenej vojny mal tento systém úplne iný zmysel ako dnes, jeho vývoj napredoval hlavne ako konkurencia Ruskej vláde a jej vývoju. Časté názory na vývoj GPS sú práve tie že s týmto systémom začala USA a je to aj pravda, ale prvý rádiofrekvenčný signál ktorý tento vývoj podnietil prišiel práve z ruskej družice a tak istý podiel na tomto systéme má určite aj Rusko. Americká vláda s vývojom systému napredovala vred. Dnes je tento navigačný systém jediný na trhu dostupný pre verejnosť, ale je všeobecne známe že funkčných pozičných systémov je omnoho viac, ktoré ale pre verejnosť dostupné nie sú. Tento navigačný systém je spustený od roku 1960 a od vtedy prešiel dlhým vývojom, až po dnešnú podobu. Verejnosti bol sprístupňovaný od roku 1990 do roku 1993 po tomto roku už bol plne prístupný. Americká vláda mala obavy o zneužitie systému a tak až do roku 2000 bola v navigačnom systéme zavedená funkcia selektívnej dostupnosti4 ,
4

selektívna dostupnosť - "Zámerné znepresnenie polohy pre civilných užívateľov GPS, selektívna

dostupnosť ang. Selective Availability (SA)"[10]

4

ktorá degenerovala presnosť na +-200 metrov. Po zrušení funkcie je dnešná presnosť týchto hodnôt na niekoľko metrov a v špeciálnych geodetických prístrojoch dokonca niekoľko centimetrov. Vzhľadom na dostupnosť signálu sa prudko rozšíril aj trh s príjmačmi, následkom čoho bol dopyt po softvéroch ktoré by boli schopné tieto dáta zobrazovať. Bežnou požiadavkou používateľov bolo aby bol systém schopný ukladať body alebo trasy, aby ich bolo možné neskôr nájsť. Na to aby sme to dokázali nám vystačí aj lacnejší a tým aj dostupnejší prístroj pre širokú verejnosť, ktorá ho môže využiť na navigovanie, alebo ukladanie dát. Podnet na výber tejto témy bol hlavne z tohto dôvodu: Prístrojov na navigáciu je široké spektrum, ale naozaj kvalitný softvér pre široké spektrum užívateľov chýba. Cieľ tejto práce ale nebol vyvinúť softvér so všetkými funkciami o ktoré používateľ má záujem, pretože by nato nebol dostatok času počas jednej práce. Snahou bolo vytvoriť základ pre ďalší, kompletnejší vývoj softvéru. Ďalším dôvodom pre spracovanie danej témy bolo vytvoriť si rozhľad medzi už dostupným softvérom5 a hardvérom6 GPS.

Výber softvéru
Pri výbere softvéru sa často stretávame s problémom nekompatibility s operačným systémom. Dnes máme dostupné rôzne navigačné aplikácie pod OS7 Windows ktoré ale nie je možné používať pod OS Linux, alebo inými. Tento problém nám môže vyriešiť správna voľba programovacieho jazyka a vývojového prostredia. V tejto práci sme sa zameriavali na OS Linux, no pri výbere programovacieho jazyka, ako aj vývojového prostredia sme kládli dôraz na kompatibilitu s inými OS aby pri budúcom pokračovaní na tomto projekte ho bolo možné zdieľať aplikáciu širokou verejnosťou.

5 6

softvér - je označenie pre programové vybavenie počítača hardvér - tu patria všetky počítače a ich súčasti, periférie (zobrazovacie jednotky, zariadenia na

vstup a výstup údajov) 7 OS - Operačný systém

5

Kapitola 1 Geograﬁcké údaje
1.1 Základné pojmy v geograﬁi

V tejto podkapitole sa vysvetľujú pojmy týkajúce sa geograﬁe, súvisiacej z GPS prístrojmi a súradnicami. Súradnicový systém "je vzájomne jednoznačné zobrazenie medzi množinou bodov

n-rozmerného priestoru a usporiadanou n-ticou skalárov (veličín či čísiel; spravidla reálnych čísiel). Tieto skaláre (pri ktorých záleží na poradí v ktorom sú uvádzané) sa nazývajú súradnice alebo koordináty."[2] WGS-84
1

"WGS 84 je pravotočivá karteziánska sústava súradníc so stredom v ťa-

žisku Zeme (vrátane morí a atmosféry). Kladná os x smeruje ku priesečníku nultého poludníka a rovníka, kladná os z ku severnému pólu a kladná os y je na obe predchádzajúce kolmá v smere doľava (90° východnej dĺžky a 0° šírky), tvorí tak pravotočivú sústavu súradníc"[12]

1

WGS-84 - World Geodetic System 1984

6

 Obrazok 1.1: Systém udávania súradníc

1.2

Kartograﬁcká projekcia - Zobrazenie Máp

Prvoradý predpoklad analýzy a tvorby mapových výstupov z geograﬁckých (vektorových2 alebo rastrových3 ) údajov je, že sa tieto údaje vzťahujú k jednotnému súradnicovému systému (vysvetlený v predošlej kapitole). Vo väčšine prípadov sú údaje z rôznych mapových podkladov, ktoré boli vyhotovené v rôznych kartograﬁckých zobrazeniach a v rôznych mierkach. Nevyhnutnou súčasťou procesu tvorby priestorovej databázy a mapových výstupov je preto transformácia súradníc objektov medzi rôznymi súradnicovými systémami. Pri spracovaní údajov berieme do úvahy min tri zobrazenia: zobrazenie vstupných máp, interné zobrazenie (v programe), zobrazenie výstupov (dáta). Ideálne je keď sa tieto zobrazenia zhodujú čo sa ale nestáva často.
2

Vektor - prvok vektorového priestoru (na rozdiel od skaláru je okrem svojej absolútnej hodnoty

určený aj smerom a orientáciou) 3 rastrová graﬁka - označuje spôsob uloženia graﬁckej informácie jednotlivých bodov usporiadaných v pomyslenej mriežke

7

Obrzok 1.2: Zpracovanie zemského povrchu do mapového zobrazenia a Význam interného kartograﬁckého zobrazenia, jednotného súradnicového systému a presnosti kartograﬁckých transformácii rastie priamo úmerne s veľkosťou spracovávaného územia a s počtom užívateľov geograﬁckej databázy. Pre lokálne databázy prístupne obmedzenému počtu užívateľov (napr. mapa zelene v intraviláne jednej obce), postačuje zadeﬁnovať lokálny pravouhlý súradnicový systém. Na malých vzdialenostiach sa zakrivenie zemského povrchu môže zanedbať. Na zjednotenie máp zelene všetkých obci okresu určite budeme potrebovať transformáciu do jednotného suradnicového systému. V prípade medzinárodných projektov, keď záujmové územie presahuje hranice jedného štátu a databázu používajú organizácie z rôznych štátov s rôznymi národnými zobrazeniami a tradíciami, sa vhodné riešenie hľadá ťažko.

1.2.1

Referenčný elipsoid

Matematická aproximácia tvaru Zeme a iných telies vo vesmíre je referenčným elipsoidom. Skutočný tvar zeme je nepravidelný, no nejedná sa len o hory, kopce ale aj samotné moria sú nepravidelne vzdialené od stredu zeme (geoid viď. obrázok 1.3). Vplýva na to nepravidelné rozloženie hmoty zeme a tým aj rôznymi gravitačnými potenciálmi na zemi. Kľudová vzdialenosť hladiny mora sa môže líšiť na niektorých miestach zeme až o 100 metrov. Základným súradnicovým systémom na referenčnom elipsoide sú zemepisné súradnice, niekedy tiež nazývané geodetické zemepisné, alebo geograﬁcké súradnice. Sú tvorené zemepisnou (geograﬁckou) šírkou a zemepisnou (geograﬁckou) dĺžkou. Zemepisné poludníky a rovnobežky vytvárajú na referenčnom elipsoide zemepisnú sieť. Referenčný elipsoid sa používa pri deﬁnícii štátnych a medzinárodných geodetic-

8

kých súradnicových systémov, pri tvorbe mapových dielov veľkých a stredných mierok, keď sa vyžaduje minimálne skreslenie.

Obrzok 1.3: Referenčný elipsoid a

1.3

GPS

"Global Positioning System, zvyčajne nazývaný GPS (armáda USA ho označuje ako NAVSTAR GPS4 ), je satelitný navigačný systém používaný na zistenie presnej pozície a poskytujúci veľmi presnú časovú referenciu takmer kdekoľvek na Zemi alebo na zemskom orbite. Používa zostavu aspoň 24 satelitov na strednom zemskom orbite."[11]. Tento navigačný systém je funkčný 24 hodín denne, celý čas dokáže poskytovať údaje. Jedná sa o pasívny dĺžkomerný družicový systém. Cieľom tohto systému je poskytovať údaje o polohe na ktorej sa prijímateľ signálu nachádza. Pôvodne bol určený na vojenské účely, na zisťovanie polohy, rýchlosti a času. Neskôr ale americká vláda rozhodla o sprístupnení GPS signálu pre verejnosť. Systém je dostupný neustále vďaka tomu že jeho družice sú rozmiestnené tak aby v každom okamihu na celej zemi boli dostupné aspoň štyri satelitné prijímače. Štyri práve preto lebo tento signál sa vypočítava zo štyroch veličín (viď obr. 1.1) tieto veličiny sú hodnoty x,y,z a posledná
4

NAVSTAR GPS - NAVigation Signal for Timing And Ranging

9

potrebná veličina je čas t. V špeciálnych prípadoch nám postačujú aj tri veličiny a to vtedy keď máme jednu z veličín známu. Preto známu, lebo niektoré prístroje sú schopné zistiť nadmorskú výšku(pr. systémy na morských lodiach). Konkurencia 1. GLONASS5 - ruský družicový navigačný systém 2. Galileo - výstavbu realizuje Európska únia. Systém Galileo by mal byť prevádzkyschopný od roku 2010. 3. Compass - vyvíjaný Čínou, regionálne používaný pod názvom Beidou 4. DORIS - systém vyvíjaný Francúzskom

1.3.1

Funkčnosť GPS systému

"To, čo sa deje v každom GPS prijímači by sme mohli opísať ako určovanie polohy meraného bodu z priesečníku guľových plôch, ktorých polomer je daný meranými vzdialenosťami. Tento systém sa nazýva tiež dĺžkomerný systém. Meranou veličinou je doba šírenia rádiového signálu z družicovej antény k anténe GPS prijímača. Rýchlosť šírenia signálu je rovná rýchlosti svetla. Každá družica v navigačnej správe okrem iných údajov posiela aj parametre svojej dráhy z ktorých vieme vypočítať aktuálnu polohu družice (XS, YS, ZS). Keď poznáme súradnice družíc, môžeme polohu užívateľa (X, Y, Z) určiť vypočítaním sústavy troch rovníc o troch neznámych. Problém merania polohy by bol jednoduchý, keby časové základne (hodiny) družice a užívateľa boli synchrónne. Hlavný problémom je doba, ktorá uplynie medzi vyslaním diaľkomerného signálu z GPS družice a jeho prijatím užívateľským GPS prijímačom. Časová základňa užívateľského zariadenia je posunutá o neznámy časový interval Dt, ktorý môžeme prepočítať na vzdialenosť b = c Dt (kde c je rýchlosť svetla). K neznámym súradniciam užívateľa pristupuje teda neznáma b a pre výpočet polohy potrebujeme celkom štyri rovnice
5

GLONASS - Globálny satelitný navigačný systém

10

(xi - x)2 + (yi - y)2 + (zi - z)2 = Di + b Di = c tmi i = 1, 2, 3, 4 "[11].

1.4
1.4.1

Možnosti zobrazenia máp
On-line mapy

Vo všeobecnosti majú veľké množstvo dát. Tieto mapy sú rozdelené na množstvo fotograﬁí ktoré sú kalibrované GPS súradnicami tak aby tvorili jeden celok. Počet obrázkov na ktoré sú rozdelené je určený priblížením. Každý obrázok má konštantnú veľkosť v pixloch. Mapy ktoré vidíme sú delené, na konštantnú veľkosť. Čím je priblíženie väčšie tým je počet obrázkov väčší. Pri pohľade na mapu vidíme, že približovaním sa zväčšuje detail na mape. Väčšina užívateľov si pritom vôbec neuvedomí že priblížením sa pozerá na úplne inú fotograﬁu = mapu rovnakú no z väčším počtom detailov. V súčasnosti máme možnosť výberu rôznych dostupných on-line máp. Medzi najznámejšie partia: • OpenStreetMap • GoogleMaps • MapQuest • Yahoo! Maps • Multimap.com (Spojené kráľovstvo) • Map24 Každé majú svoje výhody aj nevýhody. V nasledujúcej podkapitole budú niektoré popísané.

11

1.4.2

Spôsob sťahovania konkrétnych častí mapy

Keďže mapu nemáme dostupnú celú, musíme pri pohybe priebežne sťahovať jednotlivé jej časti. Avšak je nutné vykonať istý numerický prepočet. Tento prepočet sa vykoná podľa aktuálnej pozície GPS. Pri prepočte musíme zohľadniť priblíženie, veľkosť obrázka a samotné súradnice.

Pri sťahovaní obrázka zo serveru zadávame do adresy tri hodnoty: • prepočítanú zemepisnú šírku • prepočítanú zemepisnú dĺžku • hodnotu priblíženia (zvyčajne hodnoty 2-17) Dostupnosť maximálneho priblíženia určuje typ on-line mapy, rôzne on-line mapy môžu mať rôzne priblíženie.

1.4.3

Google Mapy
"je bezplatná, on-line mapová služba spoločnosti Google. Ponúka

Google maps

posúvateľné mapy a satelitné snímky celého sveta... Označenie „satelitné snímky“ však nie je celkom presné, pretože časť záberov s najväčším rozlíšením (prevažne z územia USA, ale aj napr. z Paríža) pochádza z leteckého snímkovania."[5] Satelitná snímka Tento pojem je vlastne fotograﬁa fotená (snímaná) zo satelitu z výšky približne niekoľko tisíc metrov. Táto fotograﬁa je následne spracovaná kalibráciou6 následne je možné mapu použiť na navigáciu príp. určenie polohy. Takýmito mapami disponuje aj spoločnosť Google, pod názvom "GoogleMaps".

6

Kalibrácia - je určenie presných súradníc kalibračných bodov

12

Satelitné snímky existujú v dvoch typoch: 1. Snímky s komerčného satelitu QuickBird, ktoré sú schopné snímať plochu o rozmeroch (16,5 x 16,5) km. Maximálne rozlíšenie týchto snímok je 60 cm na pixel7 (viď. obrázok 1.4). Počas jedného snímania je satelit schopný spojiť až 10 snímok čím vznikne výsledný snímok o veľkosti (16,5 x 165) km 2. Snímky z Amerického programu Landsat, ktorý pracuje od roku 1972. Najnovší satelit, ktorý pracuje v rámci tohto programu je Landsat 7. Tento satelit je schopný snímať maximálnu plochu o rozmeroch (185 x 185) km. Pracuje s rozlíšením 15 m na pixel. Zem je takto neustále snímaná až do súčasnosti.

Obrzok 1.4: Príklad zobrazenia Google Máp a

1.4.4

OpenStreetMap
"je otvorený projekt, ktorého cieľom je tvorba voľných geo-

OpenStreetMap(OSM)

graﬁckých dát, ako sú napríklad cestné mapy. Používa predovšetkým dáta z prijímačov GPS (v režime automatického zaznamenávania súradníc prechádzanej trasy), ktoré sú následne kontrolované a editované. Je založený na kolektívnej spolupráci a na koncepcii Open source8 ."[9].
7 8

pixel - skratka z angl. picture element - obrazový prvok Open source - voľne šíriteľný

13

Tvorba máp a zaznamenávanie ciest do máp sa dá považovať za úspešné vzhľadom na to, že počet používateľov týchto máp stále stúpa. Značne množstvo ľudí láka hlavne to že do tvorby máp sa môžu zapojiť a tak si môžu vytvárať mapy svojho okolia, ktoré následne môže využiť ktokoľvek. OpenStreetMap je nezisková organizácia, ktorej zakladateľ je Steve Coast. Ako organizácia sa tento projekt označuje od roku 2006. Všetky tieto dáta je možné upravovať používateľmi máp. Nato aby sme mohli dáta do databázy nahrávať a aby sa mohli neskôr porovnať je potrebné sa zaregistrovať na stránke http://www.OpenStreetMap.org. Slovenská stránka pre OSM je http://www.freemap.sk/ Šírka záberu Mapovacie rozhranie zhŕňa síce celý svet ale hlavné body pre mapova-

nie sa odohrávajú vo Francúzku, Škandinávii, na ostrove Man a v Spojenom kráľovstve. Dáta z územia USA pochádzajú z databázy TIGER9 .

Obrzok 1.5: Príklad zobrazenia Open Street Map a

Zdroj dát

nie sú ako by sme možno očakávali z konkrétnej ﬁrmy alebo organizácie,

ale od bežných používateľov ktorý si svojvoľne snímajú dané trasy. Tieto trasy následne prejdú analýzou a po zhodnotení (porovnaní so satelitnými snímkami družice Landsat7) sa dané trasy zapíšu do mapy. Týmto spôsobom je zaistený ich skutočný stav ich umiestnia.
9

TIGER - vytvorené pri sčítaní ľudu

14

Kapitola 2 Spracovanie dát z GPS prístroja
2.1 Protokol NMEA 0183
"Štandardizovaný komunikačný protokol pre prenos dát z GPS do iného

NMEA

elektronického zariadenia (najčastejšie PC) v reálnom čase. Dáta z GPS sú tematický rozdelené do niekoľkých skupín - ASCII reťazcov a posielané von z prístroja."[10] Tento protokol na najčastejšie používa pre prenos GPS dát potrebných na zobrazenie pozície používateľa, ktorý smeruje z prístrojov do PC zariadení. Každá veta začína znakom . Za znakom  pokračuje označenie dát, za ktorým sa nachádzajú konkrétne dáta. Dáta sú oddelené čiarkou, pre dobré rozonanie. V prípade že sa konkrétne dáta nedajú vypočítať (nedostupnosť signálu, nedostatok dát potrebných pre výpočet) sú prístrojom na danej pozícii posielané ako nuly ako prázdne dáta. Niektoré prijímače neposielajú všetky dáta. Popis NMEA prvkov Pred každý z kódov sa pridáva príznak GP RMB = Minimálne potrebné navigačné informácie RMC = Odporúčané minimálne tranzitné údaje GGA = Globálny pozičný systém Fixné dáta(zemepisné súradnice, nadmorská výška, počet satelitov a pod.) VTG = Kvalita a rýchlosť aktuálnej trate RMA = Minimálne potrebné navigačné informácie GSV = Viditeľné Satelity

15

Príklad NMEA dát Dáta sú dostupné: $GPGGA,110532.538,4910.1966,N,01852.6027,E,0,00,1.4,2.5,M,44.0,M,,00*57 $GPVTG,161.5,T,,M,043.8,N,081.1,K,N*06

Dáta nie sú dostupné: $GPGGA,185837.507,0000.0000,N,00000.0000,E,0,00,50.0,0.0,M,0.0,M,,00*74 $GPRMC,185837.507,V,0000.0000,N,00000.0000,E,,,050309,,*19

2.2

Formát GPX

Bol navrhnutý tak, že dáta sú uložené v XML formáte. Tento formát má veľa výhod. GPX (z angl. GPS eXchange Format) je formát súborov pre ukladanie dát vo forme HTML tagov1 . Dáta sú tak vhodné do spracovania počítačom, ale zároveň sú jednoducho čitateľné aj pre človeka. Tento formát je určený hlavne na komunikáciu internetových webov. Forma GPX vychádza z XML2 formátu. Tento formát sa vyvinul z hlavne html štandardu. Vznikol hlavne preto, lebo samotný html formát postupom času nabral na zložitosti a množstve príkazov. XML formát nemá predpísané značky (tagy), no zároveň jeho syntax je podstatne prísnejšia ako u HTML3 dát. Existujú dve verzie tohto formátu a to: • 1.0 používaná od roku 2002 • 1.1 používaná od 9. Augusta 2004
1 2

tag - značka metadát XML - rozšíriteľný značkovací jazyk (eXtensible Markup Language) 3 HTML - Hypertextový značkový jazyk HyperText Markup Language)

16

Verzie sú vzájomne kompatibilné. Verzia 1.1 priniesla nasledujúce zmeny: • tagy s obecnými informáciami o celom súbore sa presunuli do tagu metadata • miesto tagov url a urlname sa používa nový tag link • voliteľné rozširujúce tagy sa presunuli do tagu extension Programy by mali jasne deklarovať s ktorou verziou GPX vedia pracovať, aby sa predišlo situáciám kedy nebude možné niektoré GPX dáta spracovať kvôli nekompatibilite verzie.

2.2.1

Element gpx
Tento element je koreňovým elementom GPX dokumentu

"< gpx version = " 1.1 [1] " creator = " xsd:string [1] " > < metadata > metadataType </ metadata > [0..1] < wpt > wptType </ wpt > [0..*] < rte > rteType </ rte > [0..*] < trk > trkType </ trk > [0..*] < extensions > extensionsType </ extensions > [0..1] </ gpx > "[2] Hodnoty v zátvorkách znázorňujú početnosť dát v zázname. Každý začiatočný tag musí mať aj svoju ukončovaciu značku.

Príklad GPX schémy typu waypoint <wpt lat="49.210526565" lon="18.758500053"> <ele>435.097072</ele> <time>2009-10-29T21:50:20Z</time> <name>TP1149</name>

17

<cmt>TP1149</cmt> <desc>TP1149</desc> </wpt> Jednotlivé tagy môžu obsahovať niektoré z atribútov(pr: `lat`,`lon`). Samotné atribúty majú len názvy (žiadne začiatočné ani ukončovacie značky). Názvy tagov sú vždy na začiatku a na konci(pr: `ele`,`wpt`). Tagy musia obsahovať aj začiatočné aj ukončovacie značky. Príklad GPX schémy typu track <...> <name> xsd:string </name> [0..1] ? <cmt> xsd:string </cmt> [0..1] ? <desc> xsd:string </desc> [0..1] ? <src> xsd:string </src> [0..1] ? <link> linkType </link> [0..*] ? <number> xsd:nonNegativeInteger </number> [0..1] ? <type> xsd:string </type> [0..1] ? <extensions> extensionsType </extensions> [0..1] ? <trkseg> trksegType </trkseg> [0..*] ? </...> V príklade sú dáta iba popisom(informáciou o trase. Popisy nám slúžia na identiﬁkáciu trasy, pričom existencia jednotlivých popisov je podmienená typom prístroja, ktorý dáta zapisuje. Samotné dáta trás potrebné na vykreslenie sa nachádzajú v časti trkseg (názov trksegType v príklade).

2.3

Skytraq datalogger

Program vyvíjaný Jesper Zedlitz-om, je schopný spracovať dáta z prístroja s identickým názvom. Tieto dáta ukladá do výstupného formátu GPX. Samotný vývoj softvéru prešiel pod program GPSbabel, no doposiaľ je iba v testovacej verzii. Tento program

18

nemá GUI interface a spúšťanie prebieha iba v termináli. S programom je možné konﬁgurovať daný prístroj čo je dôležité pri zapisovaní(logovaní) trás do prístroja. Viac informácii o konﬁgurácii prístroja sa nachádza v tretej kapitole. Vzorové príkazy: skytraq-datalogger --info skytraq-datalogger <OPTIONS> ACTION skytraq-datalogger --dump > vystup.gpx - uloží výsledné dáta do súboru vystup.gpx Všetky ostané informácie sa vypíšu po príkaze info. Používateľ si intuitívne dokáže zvoliť nastavenia prístroja. Časť options je nepovinná(nastavenia prístroja), no v nasledujúcej časti zadávame žiadanú akciu(`--info`,`--dump`).

2.4

GPS babel

GPSbabel konvertuje dáta medzi GPS prijímačmi a mapovými programami. Tiež je vhodný na manipuláciu s týmito dátami. Tento program umožňuje prácu s dátami priamo na úrovni hardvéru t.j. prácu priamo s GPS prijímačmi. Podpora dátových formátov stále stúpa a je dostupný pod rôznymi operačnými systémami. Nekonvertuje ani neposiela mapy. Pracuje len s dátami ktoré sú na mape uložené, dátami ako trasami a zaujímavými bodmi. Pre túto prácu ho bolo vhodné použiť práve preto, že je dostupný pod rôznymi platformami4 . Komunikácia s prístrojom používaným v tejto práci - Sky traq data logger bola nedávno implementovaná. Predchádzajúci softvér postačoval na nastavenie komunikácie sťahovanie dát, no nebolo s ním možné nastaviť cieľový bod potrebný na navigáciu s prístrojom. Aby sme mohli použiť tento program museli sme nainštalovať beta verziu programu, pretože stabilná verzia doposiaľ, nepodporovala tento prístroj.
4

platforma = operačný systém

19

2.4.1

Príkazy v programe GPSbabel

Keďže s programom GPSbabel sa pracuje na úrovni príkazového riadku príkazy na konﬁguráciu sú zadávané takýmto spôsobom: Príkaz na sťahovanie dát gpsbabel -i skytraq,erase -f /dev/ttyUSB1 -o gpx -F suradnice/ke_1.gpx Príkazom žiadame zariadenie o dáta ktoré budú zároveň zo zariadenia vymazané. Príkaz na nastavenie cieľového bodu gpsbabel -i skytraq,targetlocation=49.56:18.21 -f /dev/ttyUSB 0 -o unicsv -F syntax: gpsbabel = názov programu -i = input - vstupný typ súboru/prístroja -f = ﬁle - cesta k súboru -o = output - typ výstupného súboru -F = File názov súboru do ktorého sa dáta zapíšu Je nutné podotknúť že vzorové príkazy boli zamerané na konkrétne prístroje ktoré boli v práci používané.

2.4.2

Gebabbel

Tento program je vytvorený ako nadstavba na program GPSbabel. Hlavnými črtami tohto programu je jednoduchosť a jednoúčelnosť. Je vhodným nástrojom na sťahovanie dát a komunikáciu s prístrojmi. Výhodou tohto programu je výber prístrojov, dát a akcií, ktoré sa majú vykonať. Program disponuje aktuálnou databázou prístrojov a formátov, ktoré GPSbabel podporuje.

20

Kapitola 3 GPS prístroje použité v práci
V GPS prístrojoch nastal široký rozmach práve v dnešných časoch. Máme dostupnú širokú škálu prijímačov z rôznymi presnosťami a to od 10 metrov až po niekoľko milimetrov. V prístrojoch je snaha o čo najpresnejšie dáta, ale z čo možno najnižšou spotrebou energie pre zaistenie čo najdlhšieho času snímania dát. V tejto práci sme mali k dispozícii dva prístroje ktoré boli od seba značne odlišné. Prvý prístroj mal v sebe zabudovanú vnútornú pamäť a dokázal zapisovať prejdené dáta, zobrazovať aktuálnu pozíciu čo ho robilo zaujímavejším a komplexnejším. Druhý prístroj bol modul na posielanie aktuálnych GPS dát. Výhodou tohto prístroja bol kvalitný signál a tým aj väčšia presnosť.

Spôsob pripojenia
Základným a najbežnejším spôsobom pripojenia GPS prijímača k počítaču je USB1 pripojenie. Mnoho prístrojov disponuje taktiež pripojením pomocou Bluetooth2 prenosu. Dôležité je čo počas spojenia prenášame. Ak je prijímač schopný ukladať dáta je potrebné nastaviť rôzne atribúty. Ak toho schopný nie je a má možnosť len zistiť aktuálnu pozíciu túto pozíciu posiela do počítača a je na nás ako dáta spracujeme.
1 2

USB - Univerzálna sériová zbernica (Universal serial bus) Bluetooth - bezdrôtový prenos dát

21

3.1

GPS multi tracker

Prístroj má rôzne vlastnosti. Je schopný dáta nielen posielať ale ich aj ukladať do svojej pamäte. Prístroj disponuje čipom Venus 6, ktorého výhodou oproti predošlej verzii je hlavne to, že sa vyznačuje lepším výkonom čím zvládne aj horšie podmienky(zlé počasie, miesta medzi budovami a pod.), a zároveň znížením spotreby čoho výsledkom je dlhšia pracovná doba pri rovnakej kapacite napájacej batérie. Tieto dáta sú rozdelené na trasy ktoré sme ukladali a významné body ktoré je možné osobitne značiť. Ďalšou vlastnosťou je navigácia.

3.1.1

Konﬁgurácia
V OS Linux je dostupný program

Na konﬁguráciu existuje niekoľko možností.

skytraq-datalogger, v ktorom je možné nakonﬁgurovať všetky dôležité vlastnosti pre ukladanie. Nastaviť môžme vlastnosti pripojenia a taktiež spôsob kedy má hardware zapisovať dáta do pamäte.

Pri zápise je možné nastaviť: - ako rýchlo sa máme pohybovať aby systém zapisoval (minimum a maximum) - aká má byť najmenšia vzdialenosť medzi dvoma bodmi - aký najmenší čas má byť medzi dvoma bodmi V prístroji je možné nastaviť čo má robiť ak sa mu zaplní vnútorná pamäť. Máme možnosť prestať zapisovať, alebo zapisovať do pamäte opäť od začiatku. Možnosti pripojenia Tento prístroj je možné pripojiť k počítač dvoma spôsobmi: Cez USB port a cez bezdrôtové pripojenie Bluetooth. V Linuxe zvyčjane pripájame prístroj pod portom ttyUSB0 v adresári dev: /dev/ttyUSB0

22

3.1.2

Sťahovanie dát a zaujímavých bodov

Dáta je možné pomocou programov (spomínaných v druhej kapitole) stiahnuť a následne zobraziť v programe ktorý podporuje formát GPX. Formát GPX je detailne popísaný v nasledujúcej kapitole.

3.1.3

Navigácia

Systém naviguje jednoduchým spôsobom. Po zapísaní cieľovej súradnice do prístroja je prístroj schopný navigovať k cieľovému bodu na pozícii LF(location ﬁnder) a systém nás naviguje pomocou ôsmich diód ktoré ukazujú smer. Keď sa nám podarí priblížiť do vzdialenosti menšej ako 15 metrov tak pri indikátore Bluetooth pripojenia začne blikať červená dióda.

3.2

Navilock GPS Bluetooth Receiver BT-308

Prístroj disponuje čipom SiRF StarII ktorý je schopný prevádzky v predtým nemysliteľných podmienkach - hustých lesoch, úzkych uliciach a údoliach, krytých parkoviskách a čiastočne aj v budovách. Občas sa môže pri týchto procesoroch prejaviť dlhší čas spracovania dát a to hlavne pri zmene rýchlosti ako pri jazde autom, na bicykli či chôdzou. Prístroj má iba pripojenie cez Bluetooth.

3.2.1

Komunikácia

Na komunikáciu je potrebné nastaviť prenosovú rýchlosť na 38600 b/s. Na pripojenie k prístroju je potrebné zadať pin kód prístroja, ktorý je nastavený od výrobcu na číslo: 2003.

3.2.2

Prijímanie aktuálnej pozície

Prístroj pošle ako GPS dáta v protokole NMEA 0183 zapísané informácie o počte družíc, pozíciu, celkovú kvalitu signálu atď. Viac o protokole NMEA v 2. Kapitole

23

Kapitola 4 Program OSM Navigation
Aplikáciu bola vyvíjaná v jazyku C++ s knižnicami Qt. Prečo práve Qt? Qt je jednoduché rozhranie a programátori ho majú radi. Vývoj tejto aplikácie prebiehal pod operačným systémom Linux a vo vývojovom prostredí Qt Creator. Dokumentácia bola generovaná pomocou aplikácie DoxyGen z komentárov v zdrojovom kóde aplikácie. Program bol vyvíjaný za účelom vizualizácie dát z gps prístrojov. Dáta sú interpretované na voľne dostupných OpenStreetMap mapách. Program môžme používať ako s gps prístrojom tak aj bez neho (zobrazovanie trás a bodov). Základ programu bol použitý z graﬁckých vzorov knižnice Qt graphics-dojo. Viac o graﬁckých vzoroch Qt Graphics Dojo nájdeme na stránke: http://labs.trolltech. com/page/Graphics/About/Dojo

4.1

Výber programovacieho jazyka a vývojového prostredia

Pri výbere programovacieho jazyka sme kládli dôraz hlavne na jednoduchosť práce s obrázkami a mapovým zobrazením. Pri rozhodovaní boli zvažované tieto prvky: 1. vhodné vzory pre danú prácu 2. množstvo dostupných knižníc na spracovanie dát 3. detailnosť popisu jednotlivých knižníc

24

Pri výbere boli hlavnými konkurentmi programovacie jazyky C++, Java a Python. Pri jazyku C++ je dostupné vývojové prostredie QT ktoré je multiplatformové. Java je tiež vhodným konkurentom vzhľadom na vyspelosť vývojového prostredia. V jazyku Python v spojení s Qt knižnicami vzniklo tzv. PyQt s ktorým je možné pracovať vo vývojovom prostredí Eric4. Na vývoj softvéru v jazyku Qt môžeme mať viacero dôvodov. Toto prostredie nám ponúka kompletnú sadu nástrojov ako vývoj GUI, programovanie až po preklad aplikácie do viacerých jazykov. Samotný C++ jazyk v spojení z Qt knižnicami sa javí ako výkonnejší oproti jazyku Python v spojení s PyQt. Pri vykresľovaní dát tento jav môže značne ovplyvniť naše rozhodnutie. Qt knižnica je rozsiahla a obsahuje všetky potrebné prvky pri vývoji softvéru. Aké nástroje na tvorbu Qt poskytuje môžeme vidieť aj vo vzorových príkladoch ktorých je veľké množstvo.

Qt

je multiplatformový1 framework2 vytvorený na vývoj aplikácií.

Vývojové prostredie sa skladá z viacerých prostriedkov a to: • Qt Creator - hlavný vývojový nástroj • Qt Designer - nástroj na graﬁcké spracovanie GUI • Qt Linguist - vytvára podporu pre viacjazyčné aplikácie, vytváranie prekladov • Qt Assistant - dokumentácia pre knižnicu QT

4.1.1

Qt Creator

Nástroj určený pre vývoj aplikácií. Pri kompilácii sa zobrazuje výstup kompilácie. Počas behu aplikácie môžme vidieť výpisy priamo v prostredí.
1 2

multiplatformový - softvér podporujúci rôzne platformy(Linux, Windows, MAC OS) framework - prostredie, v ktorom je organizovaná a napísaná ďalšia aplikácia, no je napísaná v

tom istom jazyku

25

Pri kompilácii si môžeme vybrať či budeme vytvárať debug mód, alebo konečnú verziu programu. V samotnom prostredí je možnosť program debuggovať.

4.2

Správa závislosti programu

Tento nástroj umožňuje vytvorenie Makeﬁle súboru, ktorý je potrebný pri kompilácii väčšieho programu. Nástroj funguje bez rozdielu softvérovej platformy. Kompilátor vyvára samotný Makeﬁle súbor podľa toho v akej platforme sa nachádzame pretože pre samotnú platformu kompilátor ukladá konštanty ktoré sú v každej platforme špeciﬁcké. Veľkou výhodou tohto nástoja je že nám stačí vedieť malé množstvo informácií ku kompilácii samotného programu. Projekt bol vytvorený vo vývojom prostredí Qt Creator a toto prostredie si od začiatku generuje projektový súbor (.pro) tento súbor aj automaticky dopĺňa podľa toho či pridávame ďalšie hlavičkové a zdrojové súbory. Na vytvorenie závislostí programu nám stačí zadať príkaz: qmake-qt4 OSM_Navigaton.pro Pri vytváraní Makeﬁle súboru v prostredí Qt Creator sa pridávajú ďalšie časti do príkazu podľa toho či je samotný program kompilovaný v debug verzii alebo release. Po vytvorení Makeﬁle súboru stačí program skompilovať príkazom make. Príkaz make môžme použiť s rôznymi príponami, podľa toho čo chceme vykonať, čo zobraziť. Príklad príkazu: make -w Musíme nachádzať v priečinku v ktorom je vytvorený súbor Makeﬁle. príkaz si ho vie automaticky nájsť. Jednou z používaných prípon je aj -f [názov súboru](. Pri kompilácii väčšieho programu na počítači s viacerými jadrami je vhodné použiť príponu -j [počet jadier na ktorých chceme kompilovať program]

26

4.3

Jazykové formáty programu

Balík Qt podporuje multijazyčné aplikácie. V aplikácii bola snaha o dodržanie základných pravidiel pre vytvorenie multijazyčnej aplikácie. Ako základný jazyk každej aplikácie sa zvyčajne používa angličtina v tejto aplikácii je to podobne. Viditeľné súčasti ako tlačidlá a ponuky sú v anglickom jazyku. K tomu aby sme mohli preložiť čitateľné prvky na mape, je potrebné zapisovať ich názvy v kóde pomocou funkcie tr("text"), táto funkcia je statickou metódou všetkých graﬁckých objektov v knižnici Qt. Príklad použitia: QPushButton *home = new QPushButton(tr("Ž&ilina")); Použitím funkcie tr budé zaistená možnosť pre multijazyčnosť aplikácie.

Pre nastavenie programu potrebujeme urobiť nasledujúce štyri kroky: 1. inicializovať preklady 2. pridať do projektového programu preklady 3. vytvoriť prekladový súbor 4. po úprave aktualizovať projektový súbor Po splnení krokov bude aplikácia automaticky načítavať domáci jazyk nastavený v operačnom systéme. Inicializácia prekladov: QApplication app(argc, argv); QTranslator appTranslator; appTranslator.load(QString("OSM_Nav_") +QLocale::system().name()); app.installTranslator(&appTranslator); app.setApplicationName("OSM_Navigation");

return app.exec();

27

Kód je potrebné vložiť do hlavnej časti programu pred spustením aplikácie, tú je ale potrebné kompilovať po vykonaní ďalších troch spomínaných krokov. Pridanie prekladov do projektového súboru: TRANSLATIONS += OSM_Nav_en.ts Prekladový súbor vytvoríme zadaním príkazu do shellu3 : lupdate OSM_Navigation.pro Tento príkaz musíme opakovať po každom pridaní súčastí do programu ktoré sú používateľovi viditeľné a bude ich potrebné prekladať do iného jazyka. Pri každej zmene v prekladovom súbore je potrebné vykonať príkaz: lrelease OSM_Navigation.pro Samotná aplikácia pri inicializácii kontroluje či je domovský jazyk vytvorený a ak nie je tak inicializuje základný jazyk čo je v našom prípade angličtina.

4.4

Aplikačná a dátová vrstva programu

Aplikačná časť vytvára tzv. jadro programu, v ktorom prebiehajú všetky dôležité výpočty, potrebné pre neskoršie vykresľovanie.

4.4.1

Sťahovanie častí mapy

Mapy program sťahuje len ak sme ešte na danej pozícii neboli, ak sa tak stalo tak mapy má už program stiahnuté na disku. Mapa je rozdelená na malé časti o konštantnej veľkosti v pixloch (v našom prípade je to 256*256 bodov). Z toho vyplýva že čím je priblíženie väčšie tým potrebujeme viac obrázkov na pokrytie celej mapy. Na prístup k internetovej adrese sme použili nasledujúcu knižnicu:
3

shell - príkazový riadok v Linuxe

28

QUrl

Knižnica umožňuje komunikáciu s akoukoľvek url adresou. v našom prípade

sme ju používali v tomto tvare: QString path = "http://tile.openstreetmap.org/%1/%2/%3.png"; m_url = QUrl(path.arg(zoom).arg(grab.x()).arg(grab.y())); Argumenty do tejto adresy sú vypočítavané a pridávané podľa zemepisných súradníc na ktorých sa nachádzame. Trieda QUrl sa používa v triede QNetworkAccessManager ktorá si dané obrázky ukladá do vopred vyhradenej pamäte. Postupne sa kontroluje každá časť mapy a ak sa hľadaná mapa na disku nenachádza, tak sa program pokúša danú časť stiahnuť pomocou spomínaných tried. Po kontrole úspešnosti stiahnutia konkrétnej časti mapy program obrázok uloží na disku. Pomocou tejto triedy vieme načítavať dáta do triedy QHash. QHash je trieda na hešovanie4 dát v našom prípade hešovanie obrázkov. K tejto

triede je potrebné pripraviť hešovaciu funkciu pomocou ktorej sú dáta rozoznávané. V tomto programe bola použitá táto hešovacia funkcia: uint qHash(const QPoint& p){ return p.x() * 17 ^ p.y(); } Ako kľúč v tejto funkcii bol argument bod(x,y) a pomocou tohto kľúča sa počas behu programu vyhľadávajú konkrétne časti mapy.

4.4.2

Načítanie dát zo súboru

Načítanie dát zo súboru prebieha vo formáte GPX, ak máme vstupné dáta v inom formáte je možné pomocou programu gpsbabel, ku ktorému existuje GUI aplikácia (Gebabbel). Vďaka tejto aplikácii môžeme dáta konvertovať do potrebného formátu a následne použiť v programe na vykreslenie dát.
4

Hešovacia funkcia - funkcia, ktorá prevádza vstupný reťazec do výstupného pomocou predpí-

saného kódu. Reťazec označujeme ako heš (angl. hash) a jeho dĺžka je závislá od zvolenej funkcie a musí mať ﬁxnú dĺžku.

29

Na načítavanie dát v programe je vytvorená trieda Tracks. V triede prebieha rozdelenie dát do jednotlivých zložiek, t.j. tratí a zaujímavých bodov(waypointov). Na čítanie z GPX súboru existuje v Qt modul QtXml. V tomto module sa nachádzajú všetky triedy potrebné na čítanie, zápis aj vytváranie XML súborov. Dát z trás je vo všeobecnosti oveľa väčšie množstvo ako zaujímavých bodov. Vzhľadom na to že v tomto programe boli využívané hlavne triedy z knižnice Qt, nebolo to inak ani pri načítavaní súboru. Pri čítaní bola použitá trieda QFile pomocou ktorej sa pracuje zo súbormi. Pri výbere cieľového súboru sme použili triedu QFileChooser v ktorej sa dá jednoducho nastaviť ﬁlter na konkrétny typ súboru (v našom prípade *.gpx). Pred začatím čítania zo súboru sa súbor otvorí na čítanie ako textový. Pri rozdeľovaní súboru na jednotlivé časti boli potrebné nasledujúce triedy: QXmlStreamReader Trieda do ktorej sa načítali dáta zo súboru. V triede je mož-

né jednoducho čítať XML tagy a preto bola použitá. Pri rozdeľovaní dát postupne kontrolujeme meno konkrétneho tagu a podľa toho sa rozhodujeme čo ďalej urobiť. QXmlStreamAttributes Gps dáta sú uložené ako atribúty a preto je použitá táto trieda. Trieda vytvára z konkrétnych atribútov vhodné dáta na spracovanie. V našom prípade sú to zemepisné súradnice potrebné na vykreslenie trás a zaujímavých bodov. Tieto body je vhodné ukladať s použitím triedy QPointF, ktorá reprezentuje triedu s bodmi x,y s dátovým typom reálneho čísla. V Qt moduloch existuje trieda QVector ktorá reprezentuje dynamické pole. Túto triedu bolo vhodné využiť na vytvorenie jednotlivých trás a tiež zaujímavých bodov. Keďže trás býva v jednom súbore viacej tak ako riešenie boli vybrané kontrolné body pomocou ktorých sa trasy neskôr rozdelia na jednotlivé časti. Zoznam trás je tak reprezentovaný triedou QVector<QPointF> a to preto lebo samotné trasy je nutné uchovať vo forme zemepisných súradníc počas celého ich životného cyklu v aplikácii.

30

4.4.3

Prepočítavanie dát k zobrazeniu trasy

Zobrazovanie dát prebieha paralelne s vykresľovaním mapy. Súbor a samotné rozdelenie dát na trasy a zaujímavé body prebehne osobitne a dáta vstupujú k vykresleniu ako návratová hodnota z triedy Tracks, funkcie open. Dáta, ako už bolo spomínané sú vo formáte zemepisných súradníc a v tejto forme ich dostáva trieda LightMaps, v tejto triede nastane prepočet jednotlivých súradníc do bodov na mape. Trieda oddeľuje výpočty od ich vykreslenia a to takým spôsobom, že po prepočte posiela tieto dáta triede SlippyMap. Pri posielaní dát, týkajúcich sa zaujímavých bodov nie sú dáta v zložitej triede ich štruktúra sa mení z reálnych hodnôt do celých čísel typu int a to takýmto spôsobom:

Kód v programe: QVector<QPoint> waypoints; QPoint p;

for(int i=0;i < waypointCoor.size();i++){ p = getPixelFROMlatitude(waypointCoor.at(i)); if(rangeIn(p,0)){ waypoints.append(p); } } m_normalMap->setWpt(waypoints); V tejto funkcii získavame zo vstupných GPS súradníc ich hodnoty v pixloch. Funkcia rangeIn vracia hodnotu true, ak sa daný bod nachádza na viditeľnej časti mapy. Výhodou takejto kontroly je rýchlejšie vykreslenie dát pretože program sa nesnaží vykresliť dáta mimo viditeľnej plochy. Pri vykresľovaní trás je problematika omnoho väčšia a to preto, lebo ak existuje trasa ktorá má väčšie množstvo bodov (trasa nasnímaná pri chodení z jedného miesta na druhé a naspäť) musíme vykresliť nie jednu súvislú čiaru ale viacero čiar ktoré ale tvoria jednu trasu. Tento problém sa rieši v programe

31

takým spôsobom, že trasa je rozdelená na viacero častí pomocou triedy QPolygon a to v dátovej štruktúre typu: QVectorQPolygon. Touto štruktúrou nie je ešte vyriešený problém viacerých trás a tak bolo potrebné vytvoriť ďalšiu dátovú štruktúru ktorá je dynamickým poľom predošlej. Príklad: typedef QVector<QPolygon> PolygonVector; //Vektor polygónov void setTrack(QVector<PolygonVector> pg);

4.4.4

Prepočítanie zemepisných súradníc

Ako pri spustení programu tak aj pri každom prekresľovaní (deje sa vtedy ak mapu posúvame) musíme prepočítať novú hodnotu zemepisných súradníc. Pri tomto posune sa mení hodnota gps súradnice nachádzajúca sa v strede mapy. Nová stredová pozícia sa dá vypočítať takto: QPointF dx = QPointF(delta) / qreal(tdim); QPointF center = tileForCoordinate(latitude, longitude, zoom) - dx; latitude = latitudeFromTile(center.y(), zoom); longitude = longitudeFromTile(center.x(), zoom); invalidate(); Hodnota dx je vypočítaná ako zmena pohybu a vydelená veľkosťou obrázka mapy. Funkcia tileForCoordinate nám zo zadaných zemepisných súradníc a aktuálneho priblíženia vypočíta pozíciu takto: QPointF tileForCoordinate(qreal lat, qreal lng, int zoom) { qreal zn = static_cast<qreal>(1 << zoom); qreal tx = (lng + 180.0) / 360.0; qreal ty = (1.0 - log(tan(lat * M_PI / 180.0) + 1.0 / cos(lat * M_PI / 180.0)) / M_PI) / 2.0; return QPointF(tx * zn, ty * zn); } //zn = 2^zoom

32

Následne odčíta hodnotu dx a nový centrálny bod je vyjadrený hodnotou center. Pre spätný prepočet do súradníc slúžia funkcie latitudeFromTile a longitudeFromTile tie nastavia nové hodnoty súradníc. Funkciou invalidate prepočítame pozície nových častí máp.

4.5

Užívateľská vrstva - GUI Aplikácia

GUI aplikácie sa skladá z prvkov Qt knižnice. Qt knižnica je veľmi rozsiahla a v samotnej aplikácii je využitá len malá časť jej prvkov. Samotné GUI komunikuje s aplikačnou vrstvou pomocou modulu QtCore. Modul používa mechanizmus ktorý je jednoduchý a veľmi výhodný a aj preto je v tejto aplikácii využívaný. Aplikačná vrstva reaguje pomocou slotov5 a GUI aplikácia vysiela Signál6 . Každá vonkajšia reakcia ktorú je vidieť pri práci s aplikáciou je realizovaná takýmto spôsobom.

4.5.1

Zobrazenie mapy

Veľkosť zobrazenej mapy je daná veľkosťou otvorenej aplikácie. V našom prípade je aplikácia spúšťaná s rozlíšením 800x600 bodov. Mapa sa nevykresľuje ako celok ale je postupne vykresľovaná triedou QPainter. Program vykresľuje časť mapy ktorá je aktuálne potrebná, táto časť sa môže zmeniť napr. pri posúvaní mapy do niektorého zo smerov. Príklad vykreslenej mapy môžme vidieť na obrázku 4.1 Pri zmenšení alebo zväčšení mapy musíme prekresliť na mape nové časti pretože pri priblížení alebo vzdialení sa nám mierkou zmenil obrázok na obrázok s iným detailom čo môžme spozorovať aj úplne iným snímkom. Základné zmeny ktoré sa pri prekresľovaní dejú môžeme rozdeliť na dve časti: • presúvanie sa po mape • zmena veľkosti mierky (`zoomovanie`)
5 6

Slot - funkcia, ktorá je volaná pri konkrétnom signáli Signal - je emitovaný pri konkrétnej udalosti

33

Obrzok 4.1: Trasa a významné body vykreslené na OSM mape a Presúvanie sa po mape Program si pamätá jednu základnú súradnicu v jeho strede

tzv. center. Od tejto súradnice sa odvíja celková poloha mapy ktorá je viditeľná. Posun po mape je riešený dvoma spôsobmi: • posun klávesovými šípkami • posun uchytením mapy myšou presun do žiadanej časti Pri každej zmene mapy je potrebné v aplikačnej časti programu prepočítať nové hodnoty každej časti mapy. Zmena veľkosti mierky viacerými spôsobmi: • dvojkliknutím na plochu mapy(ľavé tlačidlo priblíži mapu a pravé mapu vzdiali) • rolovaním kolieskom myši Ak chceme mapu zmenšiť, alebo zväčšiť môžeme tak urobiť

34

• kliknutím na tlačidlá priblíženia a vzdialenia Pri týchto úkonoch sa vyvolávajú funkcie ktoré zmenia nastavenia priblíženia mapy (zoom-u) a následne sa vyvolá prekreslenie mapy.

4.5.2

Pripojenie GPS zariadenia

V tejto aplikácii existujú dve možnosti ako zariadenie pripojiť. Na výber nás v aplikácii vyzve podoknom (obr. 4.2). Prvá možnosť je pripojenie pomocou USB portu kde po pripojení vytvára OS port ttyUSB0. Z tohto portu je možné čítať dáta vo forme NMEA protokolu. Druhou možnosťou je pripojiť zariadenie pomocou bezdrôtového pripojenia Bluetooth. V aplikácii je potrebné zadať MAC7 . V prípade, že si v aplikácii zvolíme bezdrôtové pripojenie musíme zadať MAC adresu zariadenia (obr. 4.2). Po úspešnom pripojení už je možné čítať potrebné dáta.

Obrzok 4.2: Výber spôsobu pripojenia a

4.5.3

Hľadanie aktuálnej pozície

Hľadanie aktuálnej pozície má určitú postupnosť krokov. Ak je GPS zariadenie aktívne. Môže sa spustiť vyhľadávanie aktuálnej pozície. Príjem dát je riešený podprocesom ktorý spustí príkaz na čítanie dát z jedného z portu (USB – ttyUSB0, Bluetooth – rfcomm0). Prístroj posiela dáta v protokole NMEA, dáta stačí rozdeliť a vhodne použiť na zistenie aktuálnej pozície.
7

MAC - Riadenie prístupu k médiu (Media Acces Control) = hardvérová adresa

35

Po výzve používateľa sa výsledné dáta načítajú a pravidelne zobrazujú na mape. Vizuálnym výsledkom je mapa na ktorej je zobrazená naša aktuálna pozícia. Príkazy na čítanie dát: cat /dev/rfcomm0 cat /dev/ttyUSB0 - v prípade pripojenia cez Bluetooth - v prípade zariadenia pripojeného cez USB

4.6

Licencia aplikácie a požitých knižníc a programov

V programe boli použité najme Knižnicou Qt , ktorá je pod licenciou GNU8 GPL 29 pre nekomerčné využitie. Program Gebabbel má licenciu GNU GPL 2 a vlastník práv je Christoph Eckert. Program GPSbabel dovoľuje použitie pod licenciu GNU GPL 2, samotné časti programu môžu byť pod licenciu vlastníka samotnej časti.

8 9

GNU GPL - General public licence

36

Záver
Úlohou v tejto práci bolo vytvorenie aplikácie ktorá bude schopná zobrazovať GPS dáta a komunikovať prístrojmi. Požiadavky na aplikáciu v jej prvej fáze môžme považovať za splnené. Ako ďalšie časy ktoré boli do aplikácie pridané sú multijazyčný preklad, ktorý je vhodný hlavne pri zdieľaní takejto aplikácie na internete. Aplikácia bude voľne dostupná, teda je možné ju využívať na študijné ale aj praktické účely pri zobrazovaní trás a aktuálnej pozície. Vo svojej prvej fáze je možné aplikáciu spúšťať na rôznych linuxových operačných systémoch v jej plnej funkčnosti. Aplikácia nie je náročná a je možné ju spúšťať aj pri menej výkonnom hardvéri. Samotné vykresľovanie trás je už v aktuálnej verzii plne funkčné aj pri iných platformách. V tejto práci sme si ozrejmili prácu s Qt knižnicou. Veľký prínos mala aj pre samotné geograﬁcké poznatky keďže sme sa často zaoberali výpočtami spoločnými s geograﬁou. Pri porovnávaní formátov sa nám ako najvhodnejší javí formát GPX a aj preto bola práve pre tento typ súboru podporovaná vizualizácia. Samotné programy ako gpsbabel majú podporu aj graﬁckého rozhrania ktoré sa podarilo implementovať do samotnej aplikácie. Prevod dokáže hravo zvládnuť aj menej znalý používateľ tohto programu. Do budúcnosti je možné aplikáciu rozšíriť o ďalšie moduly, ktoré ju budú robiť komplexnejšou a robustnejšou.

37

Literatura 
[1] GPSbabel - časť skytraq datalogger. [2010] Dostupné na: <http://www.gpsbabel.org/htmldoc-development/fmt_skytraq.html> [2] Marián Jurík - GOL, diplomová práca . [2008] [Cit. 2010.2.22] Dostupné na: univerzitná knižnica [3] GPX format Dostupné na: <http://www.topografix.com/gpx.asp> [4] GPX ďalšie informácie [2009] Dostupné na: <http://wiki.geocaching.cz/index.php?title=GPX> [5] Google mapy. [2010] [Cit. 2010.4.16] Dostupné na: <http://sk.wikipedia.org/wiki/Google_Maps> [6] Kartograﬁcká projekcia. [1996] Dostupné na: <http://nic.sav.sk/logos/journals/geoinfo/0196/milan.html> [7] Qt Classes. [2010] Dostupné na: <http://doc.trolltech.com/3.3/classes.html> [8] Qt Graphics dojo. [2008] Dostupné na: <http://labs.trolltech.com/page/Graphics/About/Dojo> [9] Open Street mapy. [2010] [Cit. 2010.4.16] Dostupné na: <http://sk.wikipedia.org/wiki/OpenStreetMap> [10] Slovník pojmov týkajúcich sa GPS systému. [2010] [Cit. 2010.3.11] Dostupné na: <http://www.commander.sk/index.php?dok=0094>

38

[11] Wikipédia:

Global Positioning System. [2010] [Cit. 2010.4.7] Dostupné

na: <http://sk.wikipedia.org/w/index.php?title=Global_Positioning_ System&oldid=2923803> [12] Wikipédia:Svetový geodetický systém 1984 [2009][Cit. 2010.4.20]Dostupné na: <http://sk.wikipedia.org/wiki/Svetový_geodetický_systém_1984> [13] Navilock GPS Bluetooth Receiver BT-308. [2010] Dostupné na: <http://www. gpstechnologies.com.au/bt308.htm> [14] Protokol NMEA, popis. [2010] Dostupné na: <http://www.kh-gps.de/nmea-faq.htm> [15] GPS MULTITRACKER manual( MT5013 )[online]. [s.a.] [Cit. 2010.3.11] Dostupné na: <http://www.media-tech.eu/upload/manuals/MT5013_EN_user_manual. pdf>

39

Zoznam použitých skratiek
GPS - globálny pozičný systém OSM - Open street map NMEA - national marine electronic association GPX - GPS eXchange format = formát na výmenu dát OS - Operačný systém WGS-84 - World Geodetic System 1984 NAVSTAR GPS - NAVigation Signal for Timing And Ranging GLONASS - Globálny satelitný navigačný systém XML - eXtensible Markup Language(rozšíriteľný značkovací jazyk) HTML - HyperText Markup Language(Hypertextový značkový jazyk ) USB - Univerzálna sériová zbernica (Universal serial bus) MAC - Riadenie prístupu k médiu (Media Acces Control) = hardvérová adresa GNU - „GNU Nie je Unix“ (angl. „GNU's Not Unix“) GPL - General public licence

Zoznam obrzkov a
1.1 1.2 1.3 1.4 1.5 4.1 4.2 Systém udávania súradníc . . . . . . . . . . . . . . . . . . . . . . . . . Zpracovanie zemského povrchu do mapového zobrazenia . . . . . . . . Referenčný elipsoid . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Príklad zobrazenia Google Máp . . . . . . . . . . . . . . . . . . . . . . Príklad zobrazenia Open Street Map . . . . . . . . . . . . . . . . . . . Trasa a významné body vykreslené na OSM mape . . . . . . . . . . . . Výber spôsobu pripojenia . . . . . . . . . . . . . . . . . . . . . . . . . 7 8 9 13 14 34 35

41

Prílohy
DVD obsahujúce: 1. Elektronickú verziu bakalárskej práce 2. Inštalačný balík programu OSM Navigation 3. Používateľská a programátorská príručka s návodmi na inštaláciu

42

Súhlasím, aby sa bakalárska práca s názvom Softvér pre komunikáciu s GPS modulom a zobrazovanie GPS dát požičiavala v knižnici na študijné účely.

V Žiline dňa . . . . . . . . . . . . . . . . . . Podpis . . . . . . . . . . . . . . . . . . Dušan Ščensný

